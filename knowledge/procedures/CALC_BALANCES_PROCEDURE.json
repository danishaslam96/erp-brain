{
  "name": "CALC_BALANCES",
  "type": "PROCEDURE",
  "line_count": 178,
  "tables_referenced": [
    "PURCHASE_INVOICE_DETAIL",
    "PNUM_DUE",
    "PAYMENTS_MT",
    "INVOICE_DETAIL",
    "STAX_RATES_MT",
    "PNUM_UNDUE",
    "LNUM_PAY_TOT",
    "LNUM_ADV_PAY"
  ],
  "body_snippet": "procedure Calc_Balances(pnum_supplier_customer NUMBER,pnum_bal_of VARCHAR2,pnum_due OUT NUMBER, pnum_undue OUT NUMBER,pnum_onacct OUT NUMBER,pnum_advance OUT NUMBER,pnum_endtot OUT NUMBER,pvch_Dr_Cr OUT VARCHAR2) is\n\t\tlnum_pay_paid\t\tNUMBER(15,2);\n\t\tlnum_pay_disc\t\tNUMBER(15,2);\n    lnum_total      NUMBER(15,2);\n    lnum_pay_tot    NUMBER(15,2);\n    lnum_dis_tot    NUMBER(15,2);\n    lnum_end_tot    NUMBER(15,2);\n    lnum_adv_pay    NUMBER(15,2);\n    lnum_adv_dis    NUMBER(15,2);\n    lvch_Dr_Cr      VARCHAR2(2);\nBEGIN\n\n\t\tIF (pnum_bal_of='S') THEN   -- BALANCES FOR SUPPLIER\n      ------------          CALCULATING UNDUE AMOUNT\n      SELECT  SUM(SUM( NVL((PD.AMOUNT*NVL(UNDUE.rate,0)/100)+PD.AMOUNT,0))-NVL(PAYMENT.PAY,0)) undue\n      INTO pnum_undue\n      FROM    PURCHASE_INVOICE_DETAIL PD,PURCHASE_INVOICE_MT PM,\n      (SELECT NVL(SUM(SR.tax_rate),0)rate,SM.STAX_GROUP_ID\n      FROM  STAX_RATES_MT SR,STAX_GROUP_MT SM,STAX_GROUP_DETAIL SD\n      WHERE SM.STAX_GROUP_ID=SD.STAX_GROUP_ID(+)\n      AND   SD.STAX_RATE_ID=SR.STAX_RATE_ID(+)\n      GROUP BY SM.STAX_GROUP_ID) UNDUE,\n      (SELECT PAYMENT_DETAILS.PURCHASE_INVOICE_ID,NVL(sum(PAYMENT_DETAILS.PAID_AMOUNT),0)+\n      NVL(SUM(PAYMENT_DETAILS.DISCOUNT_AMOUNT),0) pay\n      FROM \t PAYMENTS_MT,PAYMENT_DETAILS\n      WHERE  PAYMENTS_MT.PAYMENT_ID=PAYMENT_DETAILS.PAYMENT_ID\n      AND \t PAYMENTS_MT.SUPPLIER_ID=pnum_supplier_customer\n      AND    PAYMENT_DETAILS.WIZ_PAYMENT_TYPE_ID=2\n      OR     (PAYMENT_DETAILS.WIZ_PAYMENT_TYPE_ID=3 AND PAYME"
}