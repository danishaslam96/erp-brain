{
  "name": "GET_PQTY",
  "type": "FUNCTION",
  "line_count": 43,
  "tables_referenced": [
    "PYRN_MV",
    "PURCHASE_ORDER_MT",
    "DC_FROM_HO_2_MILL_DET",
    "CF_PQTY"
  ],
  "body_snippet": "FUNCTION GET_PQTY(itemid number)\nRETURN NUMBER\nIS\n    CF_PQTY NUMBER := 0;\nBEGIN\n  SELECT NVL(PENDING,0)\n  INTO CF_PQTY\n  FROM PYRN_MV A\n/* COMMENTED ON  23/02/2023\n   NVL(SUM(NVL(POD.PRIMARY_QTY,0)-NVL(GRN.GRN_QTY,0)),0)  INTO CF_PQTY\n FROM \n PURCHASE_ORDER_MT      POMT\n,SUPPLIER_MT            SUP\n,PURCHASE_ORDER_DET     POD\n,ITEMS_MT               ITM\n,WIZ_UOM_MT             UOM\n,(SELECT\n LCD.MATCH_WITH_PO_DET_ID\n,SUM(GD.PRIMARY_ACCEPTED_QTY)      GRN_QTY \nFROM \n  DC_FROM_HO_2_MILL_DET   LCD\n ,DC_FROM_HO_2_MILL_MT    LCMT\n ,GRN_DETAIL              GD\n ,GRN_MT                  GMT\nWHERE LCD.DC_HO_2_MILL_DET_ID   =   GD.MATCH_WITH_ID\nAND LCD.DC_HO_2_MILL_ID         =   LCMT.DC_HO_2_MILL_ID\nAND GD.GRN_ID                   =   GMT.GRN_ID\nAND GMT.MATCH_WITH              =   'L'\nAND LCD.MATCH_WITH_PO_DET_ID IS NOT NULL\nAND LCMT.INV_BOOK_ID =  100987   \nGROUP BY LCD.MATCH_WITH_PO_DET_ID\n) GRN\nWHERE POMT.SUPPLIER_ID  =   SUP.SUPPLIER_ID\nAND POMT.ORDER_ID       =   POD.ORDER_ID\nAND POMT.INV_BOOK_ID    =   100954 \nAND POD.ITEM_ID         =   ITM.ITEM_ID\nAND ITM.PRIMARY_UOM     =   UOM.UOM_ID\nAND POD.PO_DET_ID       =   GRN.MATCH_WITH_PO_DET_ID(+)\nAND POD.PRIMARY_QTY-NVL(GRN.GRN_QTY,0) > 0 AND  NVL(POD.CLOSED_YN,0) = 0*/\nWHERE A.ITEM_ID    =  ITEMID;\n RETURN (CF_PQTY);\n EXCEPTION WHEN NO_DATA_FOUND THEN RETURN 0; \nEND GET_PQTY;\n"
}